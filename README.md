# Виджет банковских операций.  

Приложение для анализа транзакций, которые находятся в Excel-файле. Приложение генерирует JSON-данные для веб-страниц, формирует JSON-отчеты, а также осуществляет поиск переводов физическим лицам.

## Установка:

1. Клонируйте репозиторий: git@github.com:gabdrakhmanov-D/coursework.git
2. Обновите зависимости с помощью команды `poetry update`.

## Использование:  

Для запуска программы необходимо запустить файл src\main.py. Например, это можно сделать с помощью командной строки, введя команду: python 'ПУТЬ К ФАЙЛУ'\main.py . Для обработки файла с расширением *.xlsx программой его необходимо скопировать в папку \data в корне проекта.

## Документация:

### 1. Модуль utils.py содержит 8 функции:
Функция **get_date**, возвращает строку с датой и временем в формате YYYY-MM-DD HH:MM:SS.

**excel_file_reader**, функция для считывания финансовых операций из Excel, принимает путь к файлу Excel в качестве аргумента. Возвращает список словарей с транзакциями.

Функция **filter_transactions**, принимает список транзакций и текущую дату в формате YYYY-MM-DD HH:MM:SS. Возвращает отфильтрованный по дате ДатаФрейм. Фильтрация идет с начала текущего месяца и до текущего дня

Функция **top_transaction**, принимает датафрейм и возвращает список топ 5 транзакций

Функция **get_expenses_and_cashback**, принимает отсортированный по дате датафрейм со списком транзакций, возвращает по каждой карте:
    - последние 4 цифры карты;
    - общая сумма расходов;
    - кешбэк (1 рубль на каждые 100 рублей).

Функция **read_json_from_file**, считывает из json-файла список акций и валют.


**get_stocks_prices**, функция для получения котировок акций. Принимает список акций и возвращает их стоимость.

**get_exchange_currency**, функция для получения курсов валют. Принимает список валют и возвращает курс к рублю.

### 2. Модуль views.py содержит 1 функцию:

Функция **get_user_operations**, принимает текущую дату и возвращает JSON:  
    Приветствие в формате:  
    "???", где ??? — «Доброе утро» / «Добрый день» / «Добрый вечер» / «Доброй ночи» в зависимости от текущего времени.  
    По каждой карте:  
    - последние 4 цифры карты;  
    - общая сумма расходов;  
    - кешбэк (1 рубль на каждые 100 рублей).  
    - Топ-5 транзакций по сумме платежа.  
    - Курс валют.  
    - Стоимость акций из S&P500.  

### 3. Модуль services.py содержит 1 функцию:  

**search_for_transfers**, возвращает JSON со всеми транзакциями, которые относятся к переводам физлицам.

### 4. Модуль reports.py содержит 1 функцию и 1 декоратор:  
Декоратор **write_to_file**, который записывает отчет в файл. Если передано имя файла создает файл с этим именем, иначе файл называется report_by_category.json

Функция **spending_by_category**, возвращает траты по заданной категории за последние три месяца (от переданной даты). Если дата не передана, то берется текущая дата. Формат даты для передачи: dd.mm.yyyy 


### 4. Модуль main.py содержит 1 функцию:  

Функция **start_functionality** для получения результата всех реализованных в проекте функциональностей.
Возвращает ответ от функции **get_user_operations** и **search_for_transfers**. Так же запрашивает у пользователя название категории, дату для функции **spending_by_category** и название файла для сохранения результата.

## Тестирование функций:
***Для запуска тестов необходимо выполнить команду `pytest`***  
Для тестирования функций написаны параметризованные тесты, используется Mock  и patch. Покрытие кода тестами составляет 90%. Отчет о покрытии находится в \htmlcov\index.html  
Использованные фикстуры находятся модуле conftest.py.  
 
#### *Модуль utils.py*
##### *Функция  get_date*:  
- [x] Выполнено тестирование возврата текущей даты.  
##### *Функция excel_file_reader*:
- [x] Тестирование успешного чтения Excel файла.  
- [x] Тестирование случая когда Excel файл не найден.  
- [x] Тестирование случая когда Excel файл пустой.  
##### *Функция filter_transactions*:  
- [x] Тестирование успешной фильтрации транзакций
##### *Функция top_transaction*:  
- [x] Тест успешного возврата топ 5 расходов.
- [x] Тестирование случая когда в функцию передан пустой датафрейм.  
- [x] Тестирование случая, когда при выполнении функции возникает ошибка.  
##### *Функция get_expenses_and_cashback*:  
- [x] Тестирование успешной работы функции.
- [x] Тестирование случая ошибки при выполнении функции
##### *read_json_from_file*:  
- [x] Тестирование случая когда в JSON файле строка.  
- [x] Тестирование случая когда JSON файл пустой.  
- [x] Тестирования случая когда файл не найден.
- [x] Тестирование успешного чтения файла.
##### *get_stocks_prices*:
- [x] Тестирование случая когда запрос к сервису не удался
- [x] Тестирование успешного получения цены акций
##### *get_exchange_currency*:
- [x] Тестирование случая когда запрос к сервису не удался
- [x] Тестирование успешного получения курсов валют
#### *Модуль views.py*
##### *get_user_operations*:
- [x] Тестирование успешной работы функции
- [x] Тестирование ошибки чтения excel файла
- [x] Тестирование ошибки получения датафрейма
- [x] Тестирование ошибки чтения json и получения списка акций и валют
- [x] Тестирование случая когда нет списка акций
- [x] Тестирование случая когда нет списка валют
#### *Модуль services*
##### *search_for_transfers*:
- [x] Тестирование успешной работы функции
- [x] Тестирование случая возникновения ошибки в работе функции
#### *Модуль reports.py*  
##### *write_to_file*:
- [x] Тестирование работы декоратора без указания имени файла
- [x] Тестирование работы декоратора с указанием имени файла 'test'
- [x] Тестирование работы декоратора при поступлении пустого датафрейма
##### *spending_by_category*:
- [x] Тестирование успешной работы функции
#### *Модуль main.py*  
##### *start_functionality*:
- [x] Тестирование успешной работы функции


## Лицензия:  

Проект распространяется под [лицензией MIT](LICENSE).
